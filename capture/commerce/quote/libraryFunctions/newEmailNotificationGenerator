/* 
	==========================================================================
	| COMMERCE BML LIBRARY													 |
	+------------------------------------------------------------------------+
	| emailNotificationGenerator											 |
	==========================================================================
	| Generates HTML email											 		|
	==========================================================================
	Change Log
	20141211 - Julie Felberg Implemented 4 new tables with logic.  This logic involved a new line level loop and several new variables.
	20140115 - Julie Felberg Added Disposal site information
	20140115 - Julie Felberg More Disposal Site Information
*/

//Calculations
monthlyTotalBase = smallMonthlyTotalBase_quote + largeMonthlyTotalBase_quote;
monthlyTotalTarget = smallMonthlyTotalTarget_quote + largeMonthlyTotalTarget_quote;
monthlyTotalStretch = smallMonthlyTotalStretch_quote + largeMonthlyTotalStretch_quote;
monthlyTotalSell = smallMonthlyTotalProposed_quote + largeMonthlyTotalProposed_quote;

//20141211 line level loop to populate table arrays
//declare arrays and index
AdHocIndex = 0;
AdHocDescArr = string[];
AdHocBillingMethodArr = string[];
AdHocQtyArr = string[];
AdHocTotalPriceArr = string[];
ConfigAttrDict=dict("string");
SCDocNum = string[];
ContPDocNum = string[];
ContainerArr = string[];
RatePerHaulArr = string[];
ContTypeArr = string[];
CompactorValArr = string[];
TotalServiceTimeArr = string[];
TonsPerHaulArr = string[];
DisposalSiteArr = string[];
CostPerHaulArr = string[];

//start loop
for line in line_process{
	//models
	if(NOT isnumber(line._parent_doc_number)){
		put(ConfigAttrDict, line._document_number, line._config_attributes);
	}
	//line items
	if(isnumber(line._parent_doc_number)){
		//Ad Hoc Items
		if(line._parent_line_item == "Ad-Hoc Line Items"){
			AdHocDescArr[AdHocIndex] = line.description_line;
			AdHocBillingMethodArr[AdHocIndex] = line.billingType_line;
			AdHocQtyArr[AdHocIndex] = string(line._price_quantity);
			AdHocTotalPriceArr[AdHocIndex] = string(line.sellPrice_line);
			AdHocIndex = AdHocIndex + 1;
		}
		//Service Changes
		elif(line.activity_line == "Service level change"){
			if(findinarray(SCDocNum, line._parent_doc_number) == -1){
				append(SCDocNum, line._parent_doc_number);
			}
		}
		//container
		else{
			if(findinarray(ContPDocNum, line._parent_doc_number) == -1){
				print "in the else we get these descriptions:";
				print line.description_line;
				append(ContPDocNum,line._parent_doc_number);		
				
				//LARGE_CONTAINER
				if(line.billingType_line == "Per Haul"){
					print "we have a large container";
					append(ContainerArr, line.description_line);
					append(RatePerHaulArr, string(line.perHaulRate_line));
					append(ContTypeArr, line._model_name);
					//append(CompactorValArr, "Value");
					//append(TotalServiceTimeArr, "Value");
					//append(DisposalSiteArr, "Value");
					append(CostPerHaulArr, string(line.totalFloorPrice_line));
					
					//populate compactor value
					if(containskey(ConfigAttrDict, line._parent_doc_number)){
						CAttrStr = get(ConfigAttrDict, line._parent_doc_number);
						CAttrArr = split(CAttrStr, "~");
						if(findinarray(CAttrArr, "compactorValue") > -1){
							append(CompactorValArr, CAttrArr[1 + findinarray(CAttrArr, "compactorValue")]);
						}
						else{
							append(CompactorValArr, "Not Found");
						}
						if(findinarray(CAttrArr, "landfillCode_l") > -1){
							append(DisposalSiteArr, CAttrArr[1 + findinarray(CAttrArr, "landfillCode_l")]);
						}
						else{
							append(DisposalSiteArr, "Not Found");
						}
						if(findinarray(CAttrArr, "adjustedTotalTime_l") > -1){
							append(TotalServiceTimeArr, CAttrArr[1 + findinarray(CAttrArr, "adjustedTotalTime_l")]);
						}
						else{
							append(TotalServiceTimeArr, "Not Found");
						}
						
					}
					else{
						append(CompactorValArr, "Not Found");
						append(DisposalSiteArr, "Not Found");
						append(TotalServiceTimeArr, "Not Found");
					}
					
					
				}
				//SMALL_CONTAINER
				else{
					print "we have a small container";
					append(ContainerArr, line.description_line);
					append(RatePerHaulArr, string(line.perHaulRate_line));
					append(ContTypeArr, line._model_name);
					append(CompactorValArr, "NA");
					append(TotalServiceTimeArr, "Value");
					append(DisposalSiteArr, "NA");
					append(CostPerHaulArr, "NA");
					append(TonsPerHaulArr, "NA");
				}
				
				
			}
		}
	}
}
//end 20141211 line level loop


//Declaration of tags
START_B_TAG = "<b>";
START_U_TAG = "<u";
END_B_TAG = "</b>";
END_U_TAG = "</u>";
EMPTY_P_TAG = "<p></p>";
END_P_TAG = "</p>";

//20141210 Get Full Names
ApproverFullName = "";
SubmittedByFullName = "";

NameRecordSet = BMQL("SELECT First_Name, Last_Name, User_Login FROM User_Hierarchy WHERE User_Login LIKE $Approver OR User_Login LIKE $SubmittedBy");

for eachName in NameRecordSet{
	Login = get(eachName, "User_Login");
	if(Login  == Approver){
		ApproverFullName = get(eachName, "First_Name") + " " + get(eachName, "Last_Name");
	}
	if(Login == SubmittedBy){
		SubmittedByFullName = get(eachName, "First_Name") + " " + get(eachName, "Last_Name");
	}
}
//end Get Full Names

// Start the email body here
emailBody = "<ht"+ "ml><body>";

emailBody =	emailBody + "<table style='padding-left:35px;font-family:tahoma;'><tbody><tr><td bgcolor='00B8FF' align='right' style='color:#FFFFFF;width:535px;height:40px;'><b>QUOTE APPROVAL REQUIRED&nbsp;&nbsp;</b></td></tr></tbody></table>";
// Image tag for Approval email
emailBody =	emailBody + "<img style='padding-left:200px;' src='https://" + _system_company_name + ".bigmachines.com/bmfsweb/testrepublicservices/image/RP_HorizontalLatest.jpeg'/>";
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'></p>";
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Dear " + ApproverFullName +",</p>";
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Quote "+ quoteNumber_quote+ ", " + siteName_quote + " requires your approval for the following reason(s): </p>";
// Display Reason Description - For level 1 and 2 this will be based on the approver the input attribute will differ
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'><b> " + ReasonDescription + " </b></p>";

emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'><u><i>Quote Detail:</i></u></p>";
submittersComments = "";
if(NOT isnull(SubmitComment)){
	submittersComments = SubmitComment;
}


// Display Basic information of quote like Submitter details, sales activity, division number, competitor etc.
emailBody = emailBody + "<table style=\"padding-left:35px;font: 16px Calibri;\">"
						+ "<tr>"
							+ "<td style=\"padding-left:35px;font: 16px Calibri;\">Submitted By: "+SubmittedByFullName +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Submitted Date: "+submittedDate_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Comments: "+submittersComments +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Approvals Required: "+approvalReasonDisplayWithColorTA_quote +"</td></tr>" 		
							+ "<tr><td><br/></td></tr>"
							+ "<tr><td><br/></td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Quote Description: "+quoteDescription_quote +"</td></tr>"
							+ "<tr><td><br/></td></tr>"
							+ "<tr><td><br/></td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Sales Activity: "+salesActivity_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Division Number: "+division_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Customer Name: "+_quote_process_billTo_company_name +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Competitor: "+competitor_quote +"</td></tr>";
//20141211 Email revamp
emailBody = emailBody + "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Industry: "+industry_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Segment: "+segment_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Term: "+initialTerm_quote +"</td></tr>"
							+ "<tr><td style=\"padding-left:35px;font: 16px Calibri;\">Rate Restriction: "+"RR in Progress" +"</td></tr>";
//end Email revamp							
							
emailBody = emailBody + "</table>";	

//Applying break tags whenever necessary 
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<br>";

//20141211  Container Details Table
ContIndex = 0;
if(NOT isempty(ContPDocNum)){
	emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Container Details:</p>";
	emailBody = emailBody + "<table border=\"1\" bordercolor=\"000000\"  cellspacing=\"0\" cellpadding=\"3\" >"
						+ "<tr>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Container</b></td>"	
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Compactor Asset Value</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Total Service Time</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Rate Per Haul</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Cost Per Haul</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Tons Per Haul</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Disposal Site</b></td>"
						+ "</tr>";
	
	for eachCont in ContPDocNum{
		emailBody = emailBody + "<tr>" 
			+ "<td align=\"left\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + ContainerArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + CompactorValArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + TotalServiceTimeArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + RatePerHaulArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + CostPerHaulArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + TonsPerHaulArr[ContIndex] + "</b></td>"
			+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\"><b>" + DisposalsiteArr[ContIndex] + "</b></td>"
			+ "</tr>";
		ContIndex = ContIndex + 1;
	}	
		

	emailBody = emailBody + "</table>";
}

//Applying break tags whenever necessary 
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<br>";

//end 20141211

// Display the prices in a table format
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Quote Totals:</p>";
emailBody = emailBody + "<table border=\"1\" bordercolor=\"000000\"  cellspacing=\"0\" cellpadding=\"3\" >"
						+ "<tr>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b></b></td>"	
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Cost Price</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Floor Price</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Average Price</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Target Price</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Proposed Price</b></td>"
							/*+ "<td align=\"center\" bgcolor=\"00B8FF\" style=\"color:#FFFFFF;width:80px;\"><b>ERF</b></td>"
							+ "<td align=\"center\" bgcolor=\"00B8FF\" style=\"color:#FFFFFF;width:80px;\"><b>FRF</b></td>"
							+ "<td align=\"center\" bgcolor=\"00B8FF\" style=\"color:#FFFFFF;width:80px;\"><b>Total</b></td>"*/
						+ "</tr>";
						if(commercialExists_quote){
							emailBody = emailBody +  "<tr>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  "Small Containers" + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(smallMonthlyTotalFloor_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(smallMonthlyTotalBase_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(smallMonthlyTotalTarget_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(smallMonthlyTotalStretch_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(smallMonthlyTotalProposed_quote,"USD") + "</td>"
							+ "</tr>";
						}
						if(industrialExists_quote){
							emailBody = emailBody +  "<tr>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  "Large Containers" + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(largeMonthlyTotalFloor_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(largeMonthlyTotalBase_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(largeMonthlyTotalTarget_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(largeMonthlyTotalStretch_quote,"USD") + "</td>"
								+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(largeMonthlyTotalProposed_quote,"USD") + "</td>"
							+ "</tr>";
						}
						emailBody = emailBody +  "<tr>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  "Fees" + "</td>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(totalERFFRFAdminFloorAmount_quote,"USD") + "</td>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(totalERFFRFAdminBaseAmount_quote,"USD") + "</td>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(totalERFFRFAdminTargetAmount_quote,"USD") + "</td>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" nowrap style=\"color:#000000;\">" +  formatascurrency(totalERFFRFAdminStretchAmount_quote,"USD") + "</td>"
							+ "<td bgcolor=\"FFFFFF\" align=\"right\" snowrap  tyle=\"color:#000000;\">" +  formatascurrency(totalERFFRFAdminSellAmount_quote,"USD") + "</td>"
							+ "</tr>"
						+ "<tr>"
							/*+ "<td bgcolor=\"003c69\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(monthlyTotalBase,"USD") + "</td>"
							+ "<td bgcolor=\"003c69\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(monthlyTotalTarget,"USD") + "</td>"
							+ "<td bgcolor=\"003c69\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(monthlyTotalStretch,"USD") + "</td>"*/
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  "Total Estimated Amount" + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(grandTotalFloor_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(grandTotalBase_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(grandTotalTarget_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(grandTotalStretch_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(grandTotalSell_quote,"USD") + "</td>"
							/*+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(frfTotalSell_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(erfTotalSell_quote,"USD") + "</td>"
							+ "<td bgcolor=\"00B8FF\" align=\"right\" style=\"color:#FFFFFF;\">" +  formatascurrency(erfTotalSell_quote,"USD") + "</td>"*/
							+ "</tr></table>";
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Financial Values:</p>";
emailBody =	emailBody + financialSummaryForEmailTemplate_quote;
emailBody =	emailBody + "<br/>";
emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Service Details:</p>";
emailBody =	emailBody + lineItemGridForEmailTemplate_quote;
emailBody =	emailBody + "<br/>";

//20141211  Additional Items Table
//create Additional Item table if we have adhoc items
if(NOT isempty(AdHocDescArr)){
	emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Additional Items:</p>";
	emailBody = emailBody + "<table border=\"1\" bordercolor=\"000000\"  cellspacing=\"0\" cellpadding=\"3\" >"
						+ "<tr>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Description</b></td>"	
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Quantity</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Total Price</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Billing Method</b></td>"
						+ "</tr>";
	
	//populate rows
	eachAHDIndex = 0;
	for eachAHD in AdHocDescArr{
		
		emailBody = emailBody + "<tr>"
									+ "<td align=\"left\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\">" + AdHocDescArr[eachAHDIndex] + "</td>"
									+ "<td align=\"center\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\">" + AdHocQtyArr[eachAHDIndex] + "</td>"
									+ "<td align=\"right\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\">" + AdHocTotalPriceArr[eachAHDIndex] + "</td>"
									+ "<td align=\"center\" bgcolor=\"FFFFFF\" nowrap style=\"color:#000000;\">" + AdHocBillingMethodArr[eachAHDIndex] + "</td>"
							  + "</tr>";
		eachAHDIndex = eachAHDIndex + 1;
	}					
						
	emailBody = emailBody + "</table>";
}

//Applying break tags whenever necessary 
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<br>";

//end 20141211	

//20141211  Container Comparison Table
ConfigAttrStr = "";
ConfigAttrArr = string[];
NConfigAttrStr = "";
NConfigAttrArr = string[];
if(NOT isempty(SCDocNum)){
	emailBody =	emailBody + "<p style='padding-left:35px;font: 16px Calibri'>Container Comparison:</p>";
	
	//headers for old containers
	emailBody = emailBody + "<table border=\"1\" bordercolor=\"000000\"  cellspacing=\"0\" cellpadding=\"3\" >"
						+ "<tr>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Old Container</b></td>"	
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Size</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Nbr</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Waste Type</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Frequency</b></td>"
							//+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>PRICE</b></td>"
							//+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Fees</b></td>"
						+ "</tr>";
	
	for eachSC in SCDocNum{
		if(containskey(ConfigAttrDict, eachSC)){
			ConfigAttrStr = get(ConfigAttrDict, eachSC);
			print ConfigAttrStr;
			ConfigAttrArr = split(ConfigAttrStr, "~");
			print ConfigAttrArr;
			oldSize = "";
			oldNbr = "";
			oldWT = "";
			oldFreq = "";
			print "find";
			print (findinarray(configAttrArr, "containerSize_readOnly"));
			if(findinarray(ConfigAttrArr, "containerSize_readOnly") > -1){
				oldSize = ConfigAttrArr[1 + findinarray(ConfigAttrArr, "containerSize_readOnly")];
				print "oldSize " + oldSize;
			}
			if(findinarray(ConfigAttrArr, "quantity_readOnly") > -1){
				oldNbr = ConfigAttrArr[1 + findinarray(ConfigAttrArr, "quantity_readOnly")];
				print "oldNbr" + oldNbr;
			}
			if(findinarray(ConfigAttrArr, "wasteType_readOnly") > -1){
				oldWT = ConfigAttrArr[1 + findinarray(ConfigAttrArr, "wasteType_readOnly")];
			}
			if(findinarray(ConfigAttrArr, "liftsPerContainer_readOnly") > -1){
				oldFreq = ConfigAttrArr[1 + findinarray(ConfigAttrArr, "liftsPerContainer_readOnly")];
			}
			
			emailBody = emailBody + "<tr>"
				+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + "old container" + "</td>"
				+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + oldSize + "</td>"
				+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + oldNbr + "</td>"
				+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + oldWT + "</td>"
				+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + oldFreq + "</td>"
				+ "</tr>";
		}
	}
	
	//Headers for new containers
	emailBody = emailBody + "<tr>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>New Container</b></td>"	
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Size</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Nbr</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Waste Type</b></td>"
							+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Frequency</b></td>"
							//+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>PRICE</b></td>"
							//+ "<td align=\"center\" bgcolor=\"003c69\" nowrap style=\"color:#FFFFFF;width:80px;\"><b>Fees</b></td>"
						+ "</tr>";
	//rows for new containers
	for NeachSC in SCDocNum{
		if(containskey(ConfigAttrDict, NeachSC)){
			NConfigAttrStr = get(ConfigAttrDict, NeachSC);
			NConfigAttrArr = split(NConfigAttrStr, "~");
			
			newSize = "";
			newNbr = "";
			newWT = "";
			newFreq = "";
			
			if(findinarray(NConfigAttrArr, "containerSize_sc") > -1){
				newSize = NConfigAttrArr[1 + findinarray(NConfigAttrArr, "containerSize_sc")];
			}
			if(findinarray(NConfigAttrArr, "quantity_sc") > -1){
				newNbr = NConfigAttrArr[1 + findinarray(NConfigAttrArr, "quantity_sc")];
			}
			if(findinarray(NConfigAttrArr, "wasteType_sc") > -1){
				newWT = NConfigAttrArr[1 + findinarray(NConfigAttrArr, "wasteType_sc")];
			}
			if(findinarray(NConfigAttrArr, "liftsPerContainer_sc") > -1){
				newFreq = NConfigAttrArr[1 + findinarray(NConfigAttrArr, "liftsPerContainer_sc")];
			}
			
			emailBody = emailBody + "<tr>"
					+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + "newContainer" + "</td>"
					+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + newSize + "</td>"
					+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + newNbr + "</td>"
					+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + newWT + "</td>"
					+ "<td align=\"right\" bgcolor=\"FFFFFF\"nowrap style=\"color:#000000;\">" + newFreq + "</td>"
				+ "</tr>";
		}
	}
	//end of rows for new containers
	emailBody = emailBody + "</table>";
}
						
						

//Applying break tags whenever necessary 
emailBody =	emailBody + "<br>";
emailBody =	emailBody + "<br>";

//end 20141211	
	
	
	//:document.bmDocForm.document_id.value=4653823;document.bmDocForm.action_id.value=4654396;document.bmDocForm.version_id.value=5095445;document.bmDocForm.document_number.value=-1;document.bmDocForm.id.value=5581344;bmSubmitForm("/commerce/buyside/document.jsp", document.bmDocForm, null, "performAction");		
//version_id = "4748762";
//    action_id = "4654396";
//	document_id ="4653823";
//    url = "https://testrepublicservices.bigmachines.com/commerce/buyside/document.jsp?formaction=performAction&id=" + _system_buyside_id + "&version_id=" + version_id + "&action_id=" + action_id + "&document_id=" + document_id + "&document_number=-1";
// Provide the user a transaction link to the quote so that he can click on it and approve 
emailBody = emailBody +  "<p style='padding-left:35px;font: 14px Calibri'> Please reply to this e-mail with the word " 
						+ "<b>Approve</b> or "
						+ "<b>Reject</b>; or by clicking the following link to approve within the BigMachines tool:"
						+ "<a href='"+ TransactionURL + "'>"
						+ TransactionURL + "</a></p>";
emailBody = emailBody + "</body></ht" + "ml>";

// Use the below statement when an output PDF needs to be attached
//xslName = "quote_pdf_bmClone_21";return emailBody + "$,$" + xslName;

return emailBody ;
